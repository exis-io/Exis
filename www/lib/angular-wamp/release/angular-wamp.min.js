if("undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports){var autobahn=require("autobahn");module.exports="vxWamp"}!function(){"use strict";function a(){var a;this.init=function(b){a=b||{}};var b=this.interceptors=[];return this.$get=["$rootScope","$q","$log","$injector",function(c,d,e,f){function g(a){return function(){var b=a.apply(this,arguments);return c.$apply(),b}}var h,i=d.defer(),j=i.promise,k=function(a,b,e){var f=d.defer();return c.$broadcast("$wamp.onchallenge",{promise:f,session:a,method:b,extra:e}),f.promise},l=[];angular.forEach(b,function(a){l.unshift(angular.isString(a)?f.get(a):f.invoke(a))}),a=angular.extend({onchallenge:g(k),use_deferred:d.defer},a),h=new autobahn.Connection(a),h.onopen=g(function(a,b){e.debug("Congrats!  You're connected to the WAMP server!"),c.$broadcast("$wamp.open",{session:a,details:b}),i.resolve()}),h.onclose=g(function(a,b){e.debug("Connection Closed: ",a,b),i=d.defer(),j=i.promise,c.$broadcast("$wamp.close",{reason:a,details:b})});var m=function(a,b,e,f){var i,j,k={},l=d.defer();return b=g(b),j=function(){var c=h.session.subscribe(a,b,e).then(function(a){return k=angular.extend(a,k),l.resolve(k),a});f&&f(c)},h.isOpen&&j(),i=c.$on("$wamp.open",j),k.promise=l.promise,k.unsubscribe=function(){return i(),h.session.unsubscribe(k)},k.promise},n=function(a,b,c){var f=function(c){return{result:c,type:a,args:b}},g=function(c){return e.error("$wamp error",{type:a,arguments:b,error:c}),d.reject({error:c,type:a,args:b})},h=j.then(function(){return c()}),i=[f,g];for(angular.forEach(l,function(b){(b[a+"Response"]||b[a+"ResponseError"])&&i.push(b[a+"Response"],b[a+"ResponseError"])}),i.push(function(a){return a.result},function(a){return d.reject(a.error)});i.length;){var k=i.shift(),m=i.shift();h=h.then(k,m)}return h};return{connection:h,open:function(){a.authmethods&&-1!==a.authmethods.indexOf("wampcra")&&!a.authid?e.debug("You're using WAMP CRA.  The authid must be set on $wamp before the connection can be opened, ie: $wamp.setAuthId('john.doe')"):h.open()},setAuthId:function(b,c){a.authid=b,c&&h.open()},close:function(){h.close()},subscribe:function(a,b,c,d){return n("subscribe",arguments,function(){return m(a,b,c,d)})},unsubscribe:function(a){return n("unsubscribe",arguments,function(){return a.unsubscribe()})},publish:function(a,b,c,d){return n("publish",arguments,function(){return h.session.publish(a,b,c,d)})},register:function(a,b,c){return b=g(b),n("register",arguments,function(){return h.session.register(a,b,c)})},call:function(a,b,c,d){return n("call",arguments,function(){return h.session.call(a,b,c,d)})}}}],this}angular.module("vxWamp",[]).provider("$wamp",a)}();